/*! flickrgal 2019-04-23 */

function Flickr(a){var l=a.apiKey,r=a.userId;function n(e){var i=e.target,t=JSON.parse(i.responseText);if(i.readyState===XMLHttpRequest.DONE)if(200===i.status)switch(i.type){case"collections":build_collections(t,a);var l=gallery.imageGrid.childNodes;Array.prototype.forEach.call(l,function(e){FlickrGal.prevState.push(e)});break;case"photosets":insert_albums(t,i.id)}else console.log("Flickr "+i.type+" request failed!")}return{makeApiRequest:function(e,i){var t=new XMLHttpRequest;t.open("GET",function(e,i){var t="https://api.flickr.com/services/rest/?method=";switch(e){case"collections":t+="flickr.collections.getTree";break;case"photosets":t+="flickr.photosets.getPhotos&photoset_id="+i+"&extras=description%2Curl_z%2Curl_c%2Curl_h%2Curl_k"}return t+="&format=json&nojsoncallback=1&api_key="+l+"&user_id="+r}(e,i),!0),t.type=e,t.id=i,t.onload=n,t.send()}}}function $(e){return document.querySelector(e)}function handle_click(e){var i=e.currentTarget,t=i.className;switch(console.log(t),t){case"navigate-back":for(var l in gallery.imageGrid.innerHTML="",FlickrGal.prevState)gallery.imageGrid.appendChild(FlickrGal.prevState[l]);gallery.loading.style.display="none";break;case"album":"undefined"!=typeof window&&(window.pageYOffset=document.documentElement.scrollTop=document.body.scrollTop=0),insert_images(i.id);break;case"image":insert_lightbox(i.id,i.getAttribute("album-id")),lightbox.classList.remove("hide"),console.log("yip");break;case"close":lightbox.classList.add("hide");break;case"prev":prev();break;case"next":next()}}function handle_keys(e){switch(e.keyCode){case 39:next();break;case 37:prev();break;case 27:lightbox.classList.add("hide")}}function prev(){var e=document.getElementById(FlickrGal.lightboxSet[0]);e.classList.add("hide-stage-image");var i=FlickrGal.lightboxSet.pop();FlickrGal.lightboxSet.unshift(i),(e=document.getElementById(FlickrGal.lightboxSet[0])).classList.remove("hide-stage-image"),lightbox.imageTitle.innerHTML=e.getAttribute("data-title"),lightbox.imageDesc.innerHTML=e.getAttribute("data-description")}function next(){var e=document.getElementById(FlickrGal.lightboxSet[0]);e.classList.add("hide-stage-image");var i=FlickrGal.lightboxSet.shift();FlickrGal.lightboxSet.push(i),(e=document.getElementById(FlickrGal.lightboxSet[0])).classList.remove("hide-stage-image"),lightbox.imageTitle.innerHTML=e.getAttribute("data-title"),lightbox.imageDesc.innerHTML=e.getAttribute("data-description")}function Element(e){this.el=document.createElement("div"),this.el.className=e,this.loading=document.createElement("div"),this.loading.className="image-loading",this.inner=document.createElement("div"),this.inner.className="inner",this.dummy=document.createElement("div"),this.dummy.className="dummy",this.title=document.createElement("div"),this.desc=document.createElement("div")}function get_album_pos(e){var i="";for(var t in FlickrGal.albums)FlickrGal.albums[t].id==e&&(i=t);return i}function to_lower_case(e){for(name in e)e[name]=e[name].toString().toLowerCase();return e}function fade_in_image(e,i){var t=document.getElementById(e);t.style.backgroundImage="url("+i+")";var l=t.querySelector(".image-loading");l&&(l.style.opacity=0)}function build_album(e,i,t,l){var a=e.set;for(var r in a)FlickrGal.albums.push({id:a[r].id,collectionName:i,collectionID:t,title:a[r].title,description:a[r].description,images:[]});l.setHasTitles&&gallery.imageGrid.insertAdjacentHTML("beforeend",'<h3 class="collection-title">'+i+'</h3><div class="collection collection-'+t+'"></div>')}function build_collections(e,t){var i=e.collections.collection;for(var l in i){var a=i[l],r=a.title,n=a.id;t.getAll?build_album(a,r,n,t):0<=t.set.indexOf(r.toLowerCase())&&build_album(a,r,n,t)}gallery.loading.style.display="none",Array.prototype.forEach.call(FlickrGal.albums,function(e){var i=new Element("album");i.el.id=e.id,i.title.innerHTML=e.title,i.el.setAttribute("collection-name",e.collectionName),i.el.setAttribute("collection-id",e.collectionID),i.inner.appendChild(i.title),i.el.appendChild(i.loading),i.el.appendChild(i.dummy),i.el.appendChild(i.inner),i.el.addEventListener("click",handle_click),t.setHasTitles?gallery.imageGrid.querySelector(".collection-"+i.el.getAttribute("collection-id")).appendChild(i.el):gallery.imageGrid.appendChild(i.el)}),Array.prototype.forEach.call(FlickrGal.albums,function(e){FlickrGal.gallery.makeApiRequest("photosets",e.id)}),gallery.classList.remove("hide")}function insert_albums(e,l){var a=get_album_pos(l),i=e.photoset.photo;Array.prototype.forEach.call(i,function(e){var i,t={};t.id=e.id,t.urlZ=e.url_z,t.urlC=e.url_c,t.urlH=e.url_h,t.urlK=e.url_k,t.title=e.title,t.description=e.description,t.is_primary=e.isprimary,FlickrGal.albums[a].images.push(t),i=1==t.is_primary?t.urlZ:FlickrGal.albums[a].images[0].urlZ,fade_in_image(l,i)})}function insert_images(a){gallery.imageGrid.innerHTML="";var e=new Element("image");e.inner.classList.remove("inner"),e.inner.classList.add("navigate-back"),e.inner.innerHTML="<div>Back</div>",e.inner.addEventListener("click",handle_click),e.el.appendChild(e.dummy),e.el.appendChild(e.inner),gallery.imageGrid.appendChild(e.el);var i=get_album_pos(a),t=FlickrGal.albums[i].images;Array.prototype.forEach.call(t,function(e){var i=e.urlZ,t=new Element("image"),l=e.id;t.el.id=l,t.el.setAttribute("album-id",a),t.el.appendChild(t.dummy),t.el.appendChild(t.inner),t.el.addEventListener("click",handle_click),gallery.imageGrid.appendChild(t.el),fade_in_image(l,i)})}function insert_lightbox(e,i){FlickrGal.lightboxSet=[];var t=get_album_pos(i),l=FlickrGal.albums[t].images,a="stage-"+e;lightbox.image.innerHTML="",Array.prototype.forEach.call(l,function(e){var i=document.getElementById(e.id).style.backgroundImage,t=document.createElement("div");t.id="stage-"+e.id,t.classList.add("hide-stage-image"),t.style.backgroundImage=i,t.setAttribute("data-title",e.title),t.setAttribute("data-description",e.description._content);var l=e.urlK||e.urlH||e.urlC;t.innerHTML='<div style="background-image: url('+l+')"></div>',lightbox.image.appendChild(t),FlickrGal.lightboxSet.push(t.id)});var r=FlickrGal.lightboxSet.indexOf(a),n=FlickrGal.lightboxSet.slice(r),d=FlickrGal.lightboxSet.slice(0,r);FlickrGal.lightboxSet=n.concat(d),lightbox.imageTitle.innerHTML=document.getElementById(FlickrGal.lightboxSet[0]).getAttribute("data-title"),lightbox.imageDesc.innerHTML=document.getElementById(FlickrGal.lightboxSet[0]).getAttribute("data-description"),document.getElementById(a).classList.remove("hide-stage-image")}"undefined"!=typeof window&&window.addEventListener("load",function(e){FlickrGal.init()}),"undefined"!=typeof window&&(window.FlickrGal={init:function(){if(this.albums=[],this.lightboxSet=[],this.prevState=[],window.gallery=$("#flickrgal"),gallery){gallery.className="hide";var e=document.createElement("div");e.id="lightbox",e.className="hide";var i=document.createElement("div");i.id="lightbox-ui";var t=document.createElement("div");t.id="stage";i.innerHTML='<div class="close" title="Close (Esc)"></div><div id="controls"><div id="arrow-left" class="prev" title="Prev"></div><div id="arrow-right" class="next" title="Next"></div></div><div id="info_container"><div id="info"><div id="title"></div><div id="description"></div></div></div>',t.innerHTML='<div id="image-box-container"><div><div id="image-box"></div></div></div>',e.appendChild(i),e.appendChild(t);gallery.insertAdjacentHTML("afterbegin",'<div id="loading-gallery"><div>Loading...</div></div>'),gallery.insertAdjacentHTML("beforeend",'<div id="image-grid"></div>'),gallery.appendChild(e),gallery.imageGrid=$("#image-grid");var l=$("#lightbox");l.image=$("#image-box"),l.imageTitle=$("#info > #title"),l.imageDesc=$("#info > #description"),gallery.loading=$("#loading-gallery")}this.loadGallery({apiKey:gallery.getAttribute("data-apikey"),userId:gallery.getAttribute("data-userid")})},loadGallery:function(e){if(!e.apiKey)throw"Api key not set";if(!e.userId)throw"User ID not set";e.set=to_lower_case(JSON.parse(gallery.getAttribute("data-collections"))),0<=e.set.indexOf("all")?e.getAll=!0:e.getAll=!1,e.setHasTitles=!!gallery.hasAttribute("data-titles"),[].forEach.call(document.querySelectorAll(".close,.prev,.next"),function(e){e.addEventListener("click",handle_click)}),window.addEventListener("keydown",handle_keys),this.gallery=new Flickr({apiKey:e.apiKey,userId:e.userId,getAll:e.getAll,set:e.set,setHasTitles:e.setHasTitles}),this.gallery.makeApiRequest("collections")}});