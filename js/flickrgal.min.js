/*! flickrgal 2018-05-05 */
function Flickr(a){function b(b){var c=b.target,d=JSON.parse(c.responseText);if(c.readyState===XMLHttpRequest.DONE)if(200===c.status)switch(c.type){case"collections":build_collections(d,a);var e=gallery.imageGrid.childNodes;Array.prototype.forEach.call(e,function(a){FlickrGal.prevState.push(a)});break;case"photosets":insert_albums(d,c.id)}else console.log("Flickr "+c.type+" request failed!")}function c(a,b){var c="https://api.flickr.com/services/rest/?method=";switch(a){case"collections":c+="flickr.collections.getTree";break;case"photosets":c+="flickr.photosets.getPhotos&photoset_id="+b+"&extras=description"}return c+="&format=json&nojsoncallback=1&api_key="+e+"&user_id="+f}function d(a,d){var e=new XMLHttpRequest;e.open("GET",c(a,d),!0),e.type=a,e.id=d,e.onload=b,e.send()}var e=a.apiKey,f=a.userId;return{makeApiRequest:d}}function $(a){return document.querySelector(a)}function handle_click(a){var b=a.currentTarget,c=b.className;switch(console.log(c),c){case"navigate-back":gallery.imageGrid.innerHTML="";for(var d in FlickrGal.prevState)gallery.imageGrid.appendChild(FlickrGal.prevState[d]);gallery.loading.style.display="none";break;case"album":"undefined"!=typeof window&&(window.pageYOffset=document.documentElement.scrollTop=document.body.scrollTop=0);insert_images(b.id);break;case"image":insert_lightbox(b.id,b.getAttribute("album-id")),lightbox.classList.remove("hide"),console.log("yip");break;case"close":lightbox.classList.add("hide");break;case"prev":prev();break;case"next":next()}}function handle_keys(a){switch(a.keyCode){case 39:next();break;case 37:prev();break;case 27:lightbox.classList.add("hide")}}function prev(){var a=document.getElementById(FlickrGal.lightboxSet[0]);a.classList.add("hide-stage-image");var b=FlickrGal.lightboxSet.pop();FlickrGal.lightboxSet.unshift(b),a=document.getElementById(FlickrGal.lightboxSet[0]),a.classList.remove("hide-stage-image"),lightbox.imageTitle.innerHTML=a.getAttribute("data-title"),lightbox.imageDesc.innerHTML=a.getAttribute("data-description")}function next(){var a=document.getElementById(FlickrGal.lightboxSet[0]);a.classList.add("hide-stage-image");var b=FlickrGal.lightboxSet.shift();FlickrGal.lightboxSet.push(b),a=document.getElementById(FlickrGal.lightboxSet[0]),a.classList.remove("hide-stage-image"),lightbox.imageTitle.innerHTML=a.getAttribute("data-title"),lightbox.imageDesc.innerHTML=a.getAttribute("data-description")}function Element(a){this.el=document.createElement("div"),this.el.className=a,this.loading=document.createElement("div"),this.loading.className="image-loading",this.inner=document.createElement("div"),this.inner.className="inner",this.dummy=document.createElement("div"),this.dummy.className="dummy",this.title=document.createElement("div"),this.desc=document.createElement("div")}function get_album_pos(a){var b="";for(var c in FlickrGal.albums)FlickrGal.albums[c].id==a&&(b=c);return b}function to_lower_case(a){for(name in a)a[name]=a[name].toString().toLowerCase();return a}function fade_in_image(a,b){var c=document.getElementById(a);c.style.backgroundImage="url("+b+")";var d=c.querySelector(".image-loading");!!d&&(d.style.opacity=0)}function build_image_url(a,b){return"https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+b+".jpg"}function build_album(a,b,c,d){var e=a.set;for(var f in e)FlickrGal.albums.push({id:e[f].id,collectionName:b,collectionID:c,title:e[f].title,description:e[f].description,images:[]});d.setHasTitles&&gallery.imageGrid.insertAdjacentHTML("beforeend",'<h3 class="collection-title">'+b+'</h3><div class="collection collection-'+c+'"></div>')}function build_collections(a,b){var c=a.collections.collection;for(var d in c){var e=c[d],f=e.title,g=e.id;b.getAll?build_album(e,f,g,b):b.set.indexOf(f.toLowerCase())>=0&&build_album(e,f,g,b)}gallery.loading.style.display="none",Array.prototype.forEach.call(FlickrGal.albums,function(a){var c=new Element("album");c.el.id=a.id,c.title.innerHTML=a.title,c.el.setAttribute("collection-name",a.collectionName),c.el.setAttribute("collection-id",a.collectionID),c.inner.appendChild(c.title),c.el.appendChild(c.loading),c.el.appendChild(c.dummy),c.el.appendChild(c.inner),c.el.addEventListener("click",handle_click),b.setHasTitles?gallery.imageGrid.querySelector(".collection-"+c.el.getAttribute("collection-id")).appendChild(c.el):gallery.imageGrid.appendChild(c.el)}),Array.prototype.forEach.call(FlickrGal.albums,function(a){FlickrGal.gallery.makeApiRequest("photosets",a.id)}),gallery.classList.remove("hide")}function insert_albums(a,b){var c=get_album_pos(b),d=a.photoset.photo;Array.prototype.forEach.call(d,function(a){var d,e={};e.id=a.id,e.farm=a.farm,e.server=a.server,e.secret=a.secret,e.title=a.title,e.description=a.description,e.is_primary=a.isprimary,FlickrGal.albums[c].images.push(e),1==e.is_primary?(d=build_image_url(e,"z"),fade_in_image(b,d)):(d=build_image_url(FlickrGal.albums[c].images[0],"z"),fade_in_image(b,d))})}function insert_images(a){gallery.imageGrid.innerHTML="";var b=new Element("image");b.inner.classList.remove("inner"),b.inner.classList.add("navigate-back"),b.inner.innerHTML="<div>Back</div>",b.inner.addEventListener("click",handle_click),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),gallery.imageGrid.appendChild(b.el);var c=get_album_pos(a),d=FlickrGal.albums[c].images;Array.prototype.forEach.call(d,function(b){var c=build_image_url(b,"z"),d=new Element("image"),e=b.id;d.el.id=e,d.el.setAttribute("album-id",a),d.el.appendChild(d.dummy),d.el.appendChild(d.inner),d.el.addEventListener("click",handle_click),gallery.imageGrid.appendChild(d.el),fade_in_image(e,c)})}function insert_lightbox(a,b){FlickrGal.lightboxSet=[];var c=get_album_pos(b),d=FlickrGal.albums[c].images,e="stage-"+a;lightbox.image.innerHTML="",Array.prototype.forEach.call(d,function(a){var b=document.getElementById(a.id),c=b.style.backgroundImage,d=document.createElement("div");d.id="stage-"+a.id,d.classList.add("hide-stage-image"),d.style.backgroundImage=c,d.setAttribute("data-title",a.title),d.setAttribute("data-description",a.description._content);var e=build_image_url(a,"b");d.innerHTML='<div style="background-image: url('+e+')"></div>',lightbox.image.appendChild(d),FlickrGal.lightboxSet.push(d.id)});var f=FlickrGal.lightboxSet.indexOf(e),g=FlickrGal.lightboxSet.slice(f),h=FlickrGal.lightboxSet.slice(0,f);FlickrGal.lightboxSet=g.concat(h),lightbox.imageTitle.innerHTML=document.getElementById(FlickrGal.lightboxSet[0]).getAttribute("data-title"),lightbox.imageDesc.innerHTML=document.getElementById(FlickrGal.lightboxSet[0]).getAttribute("data-description"),document.getElementById(e).classList.remove("hide-stage-image")}"undefined"!=typeof window&&window.addEventListener("load",function(a){FlickrGal.init()}),"undefined"!=typeof window&&(window.FlickrGal={init:function(){if(this.albums=[],this.lightboxSet=[],this.prevState=[],window.gallery=$("#flickrgal"),gallery){gallery.className="hide";var a=document.createElement("div");a.id="lightbox",a.className="hide";var b=document.createElement("div");b.id="lightbox-ui";var c=document.createElement("div");c.id="stage";b.innerHTML='<div class="close" title="Close (Esc)"></div><div id="controls"><div id="arrow-left" class="prev" title="Prev"></div><div id="arrow-right" class="next" title="Next"></div></div>'+'<div id="info_container"><div id="info"><div id="title"></div><div id="description"></div></div></div>',c.innerHTML='<div id="image-box-container"><div><div id="image-box"></div></div></div>',a.appendChild(b),a.appendChild(c);gallery.insertAdjacentHTML("afterbegin",'<div id="loading-gallery"><div>Loading...</div></div>'),gallery.insertAdjacentHTML("beforeend",'<div id="image-grid"></div>'),gallery.appendChild(a),gallery.imageGrid=$("#image-grid");var d=$("#lightbox");d.image=$("#image-box"),d.imageTitle=$("#info > #title"),d.imageDesc=$("#info > #description"),gallery.loading=$("#loading-gallery")}this.loadGallery({apiKey:gallery.getAttribute("data-apikey"),userId:gallery.getAttribute("data-userid")})},loadGallery:function(a){if(!a.apiKey)throw"Api key not set";if(!a.userId)throw"User ID not set";a.set=to_lower_case(JSON.parse(gallery.getAttribute("data-collections"))),a.set.indexOf("all")>=0?a.getAll=!0:a.getAll=!1,a.setHasTitles=!!gallery.hasAttribute("data-titles"),[].forEach.call(document.querySelectorAll(".close,.prev,.next"),function(a){a.addEventListener("click",handle_click)}),window.addEventListener("keydown",handle_keys),this.gallery=new Flickr({apiKey:a.apiKey,userId:a.userId,getAll:a.getAll,set:a.set,setHasTitles:a.setHasTitles}),this.gallery.makeApiRequest("collections")}});